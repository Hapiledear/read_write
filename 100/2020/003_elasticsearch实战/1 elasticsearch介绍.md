# 1 elasticsearch介绍
## 1.用elasticsearch解决搜索问题
搜索引擎希望解决如下问题：
- 快速的返回查询结果，这些结果都是相关的。
- 提供辅助功能，提示用户可能查找的词，对结果进行分类等。

### 1.1 提供快速查询
elasticsearch底层使用的是apache Lucene,默认情况下会将所有的数据全部进行索引（倒排索引）。这样便能成倍的加快检索速度。但是也会遇到一些问题：
- 关键字查询到了多条数据，或者是个无关的常见词。此时，可以通过调优数据和搜索来提升相关性。(第6章)
- 为了提升搜索的性能和相关性，还需要更多的磁盘空间来存储索引。增加新的博客帖子会越来越慢，因为每次添加数据就要更新索引.(第10章)

### 1.2 确保结果的相关性
使用几个算法来计算相关性的得分(relevancy score)，然后根据分数来将结果逐个排序.默认情况下，计算文档相关性得分的算法是TF-IDF.
TF-词频。所查找的单词在文档中出现的次数越多，得分越高。
IDF-逆文档词频。如果某个单词在所有文档中比较少见，那么该词的权重越高，得分也会越高。
除了算法，还可以提供定制功能，例如，标题比内容更重要，可以提高标题的比重。(第6章)

### 1.3 强大的辅助功能
- 处理错误的拼写
- 支持变体
- 使用统计信息
- 给予自动提示

## 2 典型案例
- 将Elasticsearch作为主要的后端系统：使用Elasticsearch作为唯一的数据存储，尽量使设计保持简洁。但不建议在更新较多和使用事务的系统中使用。当然，也可以使用版本控制来达到这种效果(第3章)
- 将Elasticsearch添加到现有的系统:如果你有两个数据存储，必须想方设法保持它们的**同步**。根据主要数据存储是什么类型的，以及数据是如何布局规划的，可以部署一个Elasticsearch插件，保持两者同步.
- 将Elasticsearch和现有工具一同使用:在某些用例中，无须编写任何代码，就能让Elasticsearch帮你将任务搞定。很多现成的工具可以和Elasticsearch协同工作，没有必要从头开始。例如，统一日志服务，可以直接使用Rsyslog、Logstash或Apache Flume这样的日志工具。

## 3 Elasticsearch的主要特性
- 索引：可以设置如何处理文本、如何存储处理后的文本。
- 搜索：有很多查询和过滤器供选择。
- 高级功能：缓存、实时分析、聚集功能。
- 抽象组织文档：多个索引可以单独搜索、也可以同时搜索，还可以将不同类型的文档放入不同的索引。
- 高性能：集群、动态扩容、备份机制。

### 3.1 Elasticsearch扩展了Lucene的功能
- 可以通过JSON构建查询，使用很多方式来结合不同类型的查询（第4章）
- 使用过滤器，以低成本和可缓存的方式去包含和排除搜索结果.
- 基于JSON的搜索可以同时包含查询、过滤器和聚集，聚集从匹配的文档中生成统计数据。
- 读取和改变很多设置（第11章），包括文档索引的方式。
- 文档索引的一个重要步骤就是分析，将文本中的单词变为Elasticsearch中的词条。Elasticsearch有很多分析器供选择，你也可以自行构建。（第5章）

## 4. 在Elasticsearch中组织数据
与关系型数据库不同的是，Elasticsearch以文档的形式存储数据。文档比数据表的行更为灵活，主要是因为文档可以是具有层次型的。这种灵活性鼓励你将所有属于一个逻辑实体的数据**保持在同一个文档中**，而不是让它们散落在不同的数据表的不同行中。使用这种方式，**搜索很快速**，因为无须进行表的连接或其他关系型的工作。